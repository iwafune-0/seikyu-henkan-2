<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-005: 取引先設定</title>

    <!-- Material UI CDN -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #212121;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 500;
            color: #212121;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: #fafafa;
        }

        th {
            text-align: left;
            padding: 16px;
            font-weight: 500;
            color: #616161;
            font-size: 14px;
            border-bottom: 1px solid #e0e0e0;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        tbody tr {
            cursor: pointer;
        }

        tbody tr:hover {
            background-color: #fafafa;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge.active {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .badge.inactive {
            background-color: #f5f5f5;
            color: #616161;
        }

        /* Button */
        .btn-text {
            background: none;
            border: none;
            color: #1976d2;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            transition: background-color 0.3s;
        }

        .btn-text:hover {
            background-color: rgba(25, 118, 210, 0.04);
        }

        .btn-primary {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #1565c0;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 4px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            min-height: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .modal-content {
            margin-bottom: 24px;
            min-height: 400px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            position: sticky;
            bottom: 0;
            background-color: white;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
            margin-top: 16px;
        }

        /* Form */
        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #616161;
            margin-bottom: 8px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Roboto', sans-serif;
            transition: border-color 0.3s;
        }

        input[type="text"]:hover {
            border-color: #bdbdbd;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #1976d2;
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 4px;
            padding: 24px;
            text-align: center;
            transition: border-color 0.3s;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #1976d2;
        }

        .file-upload-area.has-file {
            border-color: #2e7d32;
            background-color: #e8f5e9;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin-top: 8px;
        }

        /* Info Section */
        .info-section {
            margin-bottom: 24px;
        }

        .info-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            flex: 0 0 200px;
            font-weight: 500;
            color: #616161;
        }

        .info-value {
            flex: 1;
            color: #212121;
        }

        /* Processing Rules Section */
        .rules-display {
            background-color: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 16px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #424242;
        }

        /* Material Icons */
        .material-icons {
            font-size: 20px;
        }

        /* History Table */
        .history-table {
            margin-top: 16px;
        }

        .history-table td {
            padding: 12px 16px;
        }

        /* Message Dialog */
        .message-dialog {
            background: white;
            border-radius: 4px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .message-dialog-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #212121;
        }

        .message-dialog-content {
            font-size: 14px;
            color: #616161;
            line-height: 1.6;
            margin-bottom: 24px;
            white-space: pre-line;
        }

        .message-dialog-actions {
            display: flex;
            justify-content: flex-end;
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background-color: #bdbdbd;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: #1976d2;
        }

        .toggle-switch-handle {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: left 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-switch-handle {
            left: 26px;
        }

        .toggle-label {
            font-size: 14px;
            color: #616161;
        }

        .toggle-label.active {
            color: #1976d2;
            font-weight: 500;
        }

        /* Snackbar (Toast Notification) */
        .snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: #323232;
            color: white;
            padding: 14px 24px;
            border-radius: 4px;
            box-shadow: 0 3px 5px -1px rgba(0,0,0,0.2), 0 6px 10px 0 rgba(0,0,0,0.14), 0 1px 18px 0 rgba(0,0,0,0.12);
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }

        .snackbar.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Inline Error Message */
        .error-message {
            display: none;
            font-size: 12px;
            color: #d32f2f;
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 4px;
            padding: 8px 12px;
            margin-top: 8px;
        }

        .error-message.show {
            display: block;
        }

        input.error {
            border-color: #d32f2f;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #616161;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: color 0.3s, border-color 0.3s;
        }

        .tab:hover {
            color: #1976d2;
        }

        .tab.active {
            color: #1976d2;
            border-bottom-color: #1976d2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card Layout for Mobile - Default: hide */
        .companies-card-layout {
            display: none;
        }

        .company-card {
            background: white;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: box-shadow 0.3s;
        }

        .company-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .company-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .company-card-name {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
        }

        .company-card-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        .company-card-row:last-child {
            border-bottom: none;
        }

        .company-card-label {
            color: #616161;
        }

        .company-card-value {
            color: #212121;
        }

        /* Responsive Design */
        @media (max-width: 1023px) {
            /* Page Title */
            .page-title {
                font-size: 20px;
            }

            /* Hide table on mobile */
            .card {
                display: none;
            }

            /* Show card layout on mobile */
            .companies-card-layout {
                display: block !important;
            }

            /* Modal adjustments */
            .modal {
                width: 95%;
                min-height: 500px;
                max-height: 95vh;
                padding: 16px;
            }

            .modal-header {
                font-size: 18px;
            }

            .modal-content {
                height: 350px;
                overflow-y: auto;
            }

            /* Tabs - No horizontal scroll needed */

            .tab {
                font-size: 12px;
                padding: 10px 8px;
                white-space: nowrap;
                flex: 1;
                text-align: center;
            }

            /* Info Row */
            .info-row {
                flex-direction: column;
                gap: 8px;
            }

            .info-label {
                flex: none;
            }

            /* Modal Actions */
            .modal-actions {
                flex-direction: column-reverse;
                gap: 12px;
            }

            .modal-actions button {
                width: 100%;
                display: flex;
                justify-content: center;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">取引先設定</h1>
        </div>

        <!-- Companies Table (Desktop) -->
        <div class="card">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>取引先名</th>
                            <th>表示名</th>
                            <th>状態</th>
                            <th>最終処理日</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Company 1: ネクストビッツ様 -->
                        <tr onclick="openDetailModal('nextbits')" style="cursor: pointer;">
                            <td>ネクストビッツ</td>
                            <td>株式会社ネクストビッツ 御中</td>
                            <td><span class="badge active">有効</span></td>
                            <td>2025-10-10</td>
                        </tr>

                        <!-- Company 2: オフビートワークス様 -->
                        <tr onclick="openDetailModal('offbeat')" style="cursor: pointer;">
                            <td>オフビートワークス</td>
                            <td>株式会社オフビートワークス 御中</td>
                            <td><span class="badge active">有効</span></td>
                            <td>2025-10-08</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Companies Card Layout (Mobile) -->
        <div class="companies-card-layout">
            <!-- Company 1: ネクストビッツ様 -->
            <div class="company-card" onclick="openDetailModal('nextbits')">
                <div class="company-card-header">
                    <div class="company-card-name">ネクストビッツ</div>
                    <span class="badge active">有効</span>
                </div>
                <div class="company-card-row">
                    <span class="company-card-label">表示名</span>
                    <span class="company-card-value">株式会社ネクストビッツ 御中</span>
                </div>
                <div class="company-card-row">
                    <span class="company-card-label">最終処理日</span>
                    <span class="company-card-value">2025-10-10</span>
                </div>
            </div>

            <!-- Company 2: オフビートワークス様 -->
            <div class="company-card" onclick="openDetailModal('offbeat')">
                <div class="company-card-header">
                    <div class="company-card-name">オフビートワークス</div>
                    <span class="badge active">有効</span>
                </div>
                <div class="company-card-row">
                    <span class="company-card-label">表示名</span>
                    <span class="company-card-value">株式会社オフビートワークス 御中</span>
                </div>
                <div class="company-card-row">
                    <span class="company-card-label">最終処理日</span>
                    <span class="company-card-value">2025-10-08</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Company Detail Modal (ネクストビッツ) -->
    <div class="modal-overlay" id="detailModalNextbits">
        <div class="modal">
            <div class="modal-header">取引先詳細 - ネクストビッツ</div>
            <div class="modal-content">
                <!-- タブボタン -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('nextbits', 'basic')">基本情報</button>
                    <button class="tab" onclick="switchTab('nextbits', 'template')">テンプレート</button>
                    <button class="tab" onclick="switchTab('nextbits', 'rules')">処理ルール</button>
                    <button class="tab" onclick="switchTab('nextbits', 'history')">処理履歴</button>
                </div>

                <!-- タブコンテンツ1: 基本情報 -->
                <div class="tab-content active" id="tabBasicNextbits">
                    <div class="info-section">
                        <div class="info-row">
                            <div class="info-label">取引先名</div>
                            <div class="info-value">
                                <input type="text" value="ネクストビッツ" id="nameNextbits">
                                <div class="error-message" id="nameErrorNextbits">取引先名を入力してください</div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">表示名（Excel宛名）</div>
                            <div class="info-value">
                                <input type="text" value="株式会社ネクストビッツ 御中" id="displayNameNextbits">
                                <div class="error-message" id="displayNameErrorNextbits">表示名を入力してください</div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">状態</div>
                            <div class="info-value">
                                <div class="toggle-container">
                                    <div class="toggle-switch active" id="toggleNextbits" onclick="toggleCompanyStatus('nextbits')">
                                        <div class="toggle-switch-handle"></div>
                                    </div>
                                    <span class="toggle-label active" id="toggleLabelNextbits">有効</span>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">最終処理日</div>
                            <div class="info-value">2025-10-10</div>
                        </div>
                    </div>
                </div>

                <!-- タブコンテンツ2: テンプレート -->
                <div class="tab-content" id="tabTemplateNextbits">
                    <div class="info-section">
                        <div class="info-row">
                            <div class="info-label">現在のファイル</div>
                            <div class="info-value">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>nextbits_template.xlsx</span>
                                    <button class="btn-text" onclick="downloadTemplate('nextbits')">ダウンロード</button>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">更新日時</div>
                            <div class="info-value">2025-09-15 14:30</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">更新者</div>
                            <div class="info-value">admin@example.com</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">テンプレート更新</div>
                            <div class="info-value">
                                <div class="file-upload-area" id="fileUploadNextbits" onclick="document.getElementById('fileInputNextbits').click()">
                                    <span class="material-icons" style="font-size: 32px; color: #9e9e9e;">cloud_upload</span>
                                    <p style="margin-top: 8px; color: #616161;">クリックしてファイルを選択</p>
                                    <div class="file-info" id="fileInfoNextbits" style="display: none;">
                                        <span class="material-icons" style="color: #2e7d32;">description</span>
                                        <span id="fileNameNextbits"></span>
                                    </div>
                                </div>
                                <input type="file" id="fileInputNextbits" accept=".xlsx" style="display: none;" onchange="handleFileSelect(event, 'nextbits')">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- タブコンテンツ3: 処理ルール -->
                <div class="tab-content" id="tabRulesNextbits">
                    <div class="info-section">
                        <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px;">処理ルール（読み取り専用）</h3>
                        <div class="rules-display">注文番号: yyyymmdd-01 形式
注文書明細タイトル: yyyy年mm月作業費
発行日: 前回+1ヶ月の1日
発注金額: 請求書の合計金額
件名: 見積書の件名（パターン変換）
数量: 見積書の数量（1式→1に変換）
単価: 見積書の単価
小計・消費税・合計: 請求書と一致チェック
宛名: 株式会社ネクストビッツ 御中
明細の締め: 以下、余白

※ MVP版では読み取り専用。変更はコード修正が必要です。</div>
                    </div>
                </div>

                <!-- タブコンテンツ4: 処理履歴 -->
                <div class="tab-content" id="tabHistoryNextbits">
                    <div class="info-section">
                        <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px;">処理履歴（最新3件）</h3>
                        <p style="font-size: 12px; color: #616161; margin-bottom: 12px;">※ クリックするとP-003（処理履歴ページ）に遷移します</p>
                        <div class="card">
                            <div class="table-container">
                                <table class="history-table">
                                    <thead>
                                        <tr>
                                            <th>処理日</th>
                                            <th>処理者</th>
                                            <th>状態</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr onclick="navigateToProcessHistory('nextbits', '2025-10-10')" style="cursor: pointer;">
                                            <td>2025-10-10</td>
                                            <td>admin@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                        <tr onclick="navigateToProcessHistory('nextbits', '2025-09-10')" style="cursor: pointer;">
                                            <td>2025-09-10</td>
                                            <td>user@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                        <tr onclick="navigateToProcessHistory('nextbits', '2025-08-10')" style="cursor: pointer;">
                                            <td>2025-08-10</td>
                                            <td>admin@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-text" onclick="closeDetailModal('nextbits')">キャンセル</button>
                <button class="btn-primary" onclick="saveCompanySettings('nextbits')">保存</button>
            </div>
        </div>
    </div>

    <!-- Company Detail Modal (オフビートワークス) -->
    <div class="modal-overlay" id="detailModalOffbeat">
        <div class="modal">
            <div class="modal-header">取引先詳細 - オフビートワークス</div>
            <div class="modal-content">
                <!-- タブボタン -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('offbeat', 'basic')">基本情報</button>
                    <button class="tab" onclick="switchTab('offbeat', 'template')">テンプレート</button>
                    <button class="tab" onclick="switchTab('offbeat', 'rules')">処理ルール</button>
                    <button class="tab" onclick="switchTab('offbeat', 'history')">処理履歴</button>
                </div>

                <!-- タブコンテンツ1: 基本情報 -->
                <div class="tab-content active" id="tabBasicOffbeat">
                    <div class="info-section">
                        <div class="info-row">
                            <div class="info-label">取引先名</div>
                            <div class="info-value">
                                <input type="text" value="オフビートワークス" id="nameOffbeat">
                                <div class="error-message" id="nameErrorOffbeat">取引先名を入力してください</div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">表示名（Excel宛名）</div>
                            <div class="info-value">
                                <input type="text" value="株式会社オフビートワークス 御中" id="displayNameOffbeat">
                                <div class="error-message" id="displayNameErrorOffbeat">表示名を入力してください</div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">状態</div>
                            <div class="info-value">
                                <div class="toggle-container">
                                    <div class="toggle-switch active" id="toggleOffbeat" onclick="toggleCompanyStatus('offbeat')">
                                        <div class="toggle-switch-handle"></div>
                                    </div>
                                    <span class="toggle-label active" id="toggleLabelOffbeat">有効</span>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">最終処理日</div>
                            <div class="info-value">2025-10-08</div>
                        </div>
                    </div>
                </div>

                <!-- タブコンテンツ2: テンプレート -->
                <div class="tab-content" id="tabTemplateOffbeat">
                    <div class="info-section">
                        <div class="info-row">
                            <div class="info-label">現在のファイル</div>
                            <div class="info-value">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>offbeat_template.xlsx</span>
                                    <button class="btn-text" onclick="downloadTemplate('offbeat')">ダウンロード</button>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">更新日時</div>
                            <div class="info-value">2025-09-20 10:15</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">更新者</div>
                            <div class="info-value">admin2@example.com</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">テンプレート更新</div>
                            <div class="info-value">
                                <div class="file-upload-area" id="fileUploadOffbeat" onclick="document.getElementById('fileInputOffbeat').click()">
                                    <span class="material-icons" style="font-size: 32px; color: #9e9e9e;">cloud_upload</span>
                                    <p style="margin-top: 8px; color: #616161;">クリックしてファイルを選択</p>
                                    <div class="file-info" id="fileInfoOffbeat" style="display: none;">
                                        <span class="material-icons" style="color: #2e7d32;">description</span>
                                        <span id="fileNameOffbeat"></span>
                                    </div>
                                </div>
                                <input type="file" id="fileInputOffbeat" accept=".xlsx" style="display: none;" onchange="handleFileSelect(event, 'offbeat')">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- タブコンテンツ3: 処理ルール -->
                <div class="tab-content" id="tabRulesOffbeat">
                    <div class="info-section">
                        <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px;">処理ルール（読み取り専用）</h3>
                        <div class="rules-display">※ オフビートワークス様の処理ルールはネクストビッツ様と異なります。

発行日: 前回+1ヶ月の1日
発注金額: 請求書の合計金額
件名: 見積書の件名
数量: 見積書の数量
単価: 見積書の単価
宛名: 株式会社オフビートワークス 御中

※ MVP版では読み取り専用。変更はコード修正が必要です。</div>
                    </div>
                </div>

                <!-- タブコンテンツ4: 処理履歴 -->
                <div class="tab-content" id="tabHistoryOffbeat">
                    <div class="info-section">
                        <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px;">処理履歴（最新3件）</h3>
                        <p style="font-size: 12px; color: #616161; margin-bottom: 12px;">※ クリックするとP-003（処理履歴ページ）に遷移します</p>
                        <div class="card">
                            <div class="table-container">
                                <table class="history-table">
                                    <thead>
                                        <tr>
                                            <th>処理日</th>
                                            <th>処理者</th>
                                            <th>状態</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr onclick="navigateToProcessHistory('offbeat', '2025-10-08')" style="cursor: pointer;">
                                            <td>2025-10-08</td>
                                            <td>user@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                        <tr onclick="navigateToProcessHistory('offbeat', '2025-09-08')" style="cursor: pointer;">
                                            <td>2025-09-08</td>
                                            <td>admin@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                        <tr onclick="navigateToProcessHistory('offbeat', '2025-08-08')" style="cursor: pointer;">
                                            <td>2025-08-08</td>
                                            <td>user@example.com</td>
                                            <td><span class="badge active">成功</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-text" onclick="closeDetailModal('offbeat')">キャンセル</button>
                <button class="btn-primary" onclick="saveCompanySettings('offbeat')">保存</button>
            </div>
        </div>
    </div>

    <!-- Message Dialog -->
    <div class="modal-overlay" id="messageDialog">
        <div class="message-dialog">
            <div class="message-dialog-title" id="messageDialogTitle"></div>
            <div class="message-dialog-content" id="messageDialogContent"></div>
            <div class="message-dialog-actions">
                <button class="btn-primary" onclick="closeMessageDialog()">OK</button>
            </div>
        </div>
    </div>

    <!-- Snackbar (Toast Notification) -->
    <div class="snackbar" id="snackbar"></div>

    <script>
        // Modal Functions
        function openDetailModal(company) {
            const modalId = company === 'nextbits' ? 'detailModalNextbits' : 'detailModalOffbeat';
            document.getElementById(modalId).classList.add('active');
        }

        function closeDetailModal(company) {
            const modalId = company === 'nextbits' ? 'detailModalNextbits' : 'detailModalOffbeat';
            document.getElementById(modalId).classList.remove('active');
        }

        // File Upload Handler
        function handleFileSelect(event, company) {
            const file = event.target.files[0];
            if (file) {
                const uploadArea = document.getElementById(`fileUpload${company.charAt(0).toUpperCase() + company.slice(1)}`);
                const fileInfo = document.getElementById(`fileInfo${company.charAt(0).toUpperCase() + company.slice(1)}`);
                const fileName = document.getElementById(`fileName${company.charAt(0).toUpperCase() + company.slice(1)}`);

                uploadArea.classList.add('has-file');
                fileInfo.style.display = 'flex';
                fileName.textContent = file.name;
            }
        }

        // Message Dialog Functions
        function showMessageDialog(title, content) {
            document.getElementById('messageDialogTitle').textContent = title;
            document.getElementById('messageDialogContent').textContent = content;
            document.getElementById('messageDialog').classList.add('active');
        }

        function closeMessageDialog() {
            document.getElementById('messageDialog').classList.remove('active');
        }

        // Snackbar (Toast Notification) Function
        function showSnackbar(message) {
            const snackbar = document.getElementById('snackbar');
            snackbar.textContent = message;
            snackbar.classList.add('show');

            // 3秒後に自動で消える
            setTimeout(() => {
                snackbar.classList.remove('show');
            }, 3000);
        }

        // Template Download
        function downloadTemplate(company) {
            const filename = company === 'nextbits' ? 'nextbits_template.xlsx' : 'offbeat_template.xlsx';
            showMessageDialog('テンプレートダウンロード', `テンプレートをダウンロードします:\n${filename}`);
        }

        // Save Settings
        function saveCompanySettings(company) {
            const companyKey = company.charAt(0).toUpperCase() + company.slice(1);
            const nameInput = document.getElementById(`name${companyKey}`);
            const displayNameInput = document.getElementById(`displayName${companyKey}`);
            const nameError = document.getElementById(`nameError${companyKey}`);
            const displayNameError = document.getElementById(`displayNameError${companyKey}`);

            // エラーメッセージをクリア
            nameError.classList.remove('show');
            displayNameError.classList.remove('show');
            nameInput.classList.remove('error');
            displayNameInput.classList.remove('error');

            // バリデーション
            let hasError = false;
            let firstErrorInput = null;

            if (!nameInput.value.trim()) {
                nameError.classList.add('show');
                nameInput.classList.add('error');
                hasError = true;
                if (!firstErrorInput) firstErrorInput = nameInput;
            }

            if (!displayNameInput.value.trim()) {
                displayNameError.classList.add('show');
                displayNameInput.classList.add('error');
                hasError = true;
                if (!firstErrorInput) firstErrorInput = displayNameInput;
            }

            // エラーがある場合は保存しない
            if (hasError) {
                // 最初のエラーフィールドにスクロール + フォーカス
                if (firstErrorInput) {
                    firstErrorInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorInput.focus();
                }
                return;
            }

            // 保存成功
            closeDetailModal(company);
            showSnackbar('取引先設定を保存しました');
        }

        // Navigate to Process History Page (P-003)
        function navigateToProcessHistory(company, date) {
            const companyName = company === 'nextbits' ? 'ネクストビッツ' : 'オフビートワークス';
            showMessageDialog(
                'P-003へ遷移',
                `P-003（処理履歴ページ）に遷移します\n\n取引先: ${companyName}\n処理日: ${date}\n\n※ React実装時には、この取引先でフィルタされた状態のP-003に遷移します`
            );
        }

        // Toggle Company Status (Active/Inactive)
        function toggleCompanyStatus(company) {
            const toggle = document.getElementById(`toggle${company.charAt(0).toUpperCase() + company.slice(1)}`);
            const label = document.getElementById(`toggleLabel${company.charAt(0).toUpperCase() + company.slice(1)}`);

            if (toggle.classList.contains('active')) {
                // 有効 → 無効
                toggle.classList.remove('active');
                label.classList.remove('active');
                label.textContent = '無効';
            } else {
                // 無効 → 有効
                toggle.classList.add('active');
                label.classList.add('active');
                label.textContent = '有効';
            }
        }

        // Tab Switching Function
        function switchTab(company, tabName) {
            const companyKey = company.charAt(0).toUpperCase() + company.slice(1);

            // 全タブボタンのactiveクラスを削除
            const modal = document.getElementById(`detailModal${companyKey}`);
            modal.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            // 全タブコンテンツを非表示
            modal.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // クリックされたタブをアクティブに
            event.target.classList.add('active');
            document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}${companyKey}`).classList.add('active');
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
