# P-005: 取引先設定ページ E2Eテスト仕様書

**作成日**: 2025-10-15
**Phase**: Phase 4（ページ実装） - MVP版（モック）
**実施予定**: Phase 9（E2Eテスト）

---

## 1. テスト概要

P-005（取引先設定ページ）の全機能をE2Eテストでカバーします。管理者専用機能のため、管理者権限でのテストのみ実施します。

### テスト環境

- **ブラウザ**: Chrome, Safari, Firefox
- **デバイス**: デスクトップ（1920x1080）、タブレット（768x1024）、モバイル（375x667）
- **ユーザー**: 管理者（`admin@example.com`）
- **テストフレームワーク**: Playwright（Phase 9で導入予定）

---

## 2. テストケース一覧

### 2.1 ページアクセステスト

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-001 | 管理者がページにアクセス | 管理者でログイン済み | 1. サイドバーから「取引先設定」をクリック | - P-005が表示される<br>- 取引先一覧が表示される | 高 |
| TC-002 | 一般ユーザーがアクセス拒否 | 一般ユーザーでログイン済み | 1. URL直接入力で `/companies` にアクセス | - アクセス拒否メッセージ<br>- または自動的にホームにリダイレクト | 高 |
| TC-003 | 未認証ユーザーがリダイレクト | ログアウト状態 | 1. URL直接入力で `/companies` にアクセス | - ログインページにリダイレクト | 高 |

---

### 2.2 取引先一覧表示テスト（デスクトップ）

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-011 | テーブル表示の確認 | TC-001完了 | 1. デスクトップサイズで表示 | - テーブル形式で一覧表示<br>- 列: 取引先名、表示名、状態、最終処理日 | 高 |
| TC-012 | 有効状態の表示 | TC-001完了 | 1. 有効な取引先を確認 | - 「有効」チップが緑色で表示 | 中 |
| TC-013 | 無効状態の表示 | TC-001完了、無効な取引先が存在 | 1. 無効な取引先を確認 | - 「無効」チップがグレーで表示 | 中 |
| TC-014 | 行ホバー効果 | TC-001完了 | 1. 行にマウスオーバー | - 背景色が変わる<br>- カーソルがポインターになる | 低 |

---

### 2.3 取引先一覧表示テスト（モバイル）

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-021 | カードレイアウト表示 | TC-001完了 | 1. モバイルサイズ（375px）に変更 | - カードレイアウトに切り替わる<br>- テーブルは非表示 | 高 |
| TC-022 | カード内容の確認 | TC-021完了 | 1. カードの内容を確認 | - 取引先名、表示名、状態、最終処理日が表示される | 高 |
| TC-023 | カードタップ効果 | TC-021完了 | 1. カードをタップ | - 取引先詳細モーダルが開く | 高 |

---

### 2.4 取引先詳細モーダル - 基本操作

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-031 | モーダル表示 | TC-001完了 | 1. ネクストビッツの行をクリック | - 取引先詳細モーダルが開く<br>- タイトル: 「取引先詳細 - ネクストビッツ」<br>- 4タブ表示: 基本情報、テンプレート、処理ルール、処理履歴 | 高 |
| TC-032 | モーダルを閉じる（キャンセル） | TC-031完了 | 1. 「キャンセル」ボタンをクリック | - モーダルが閉じる<br>- 変更が破棄される | 高 |
| TC-033 | モーダルを閉じる（オーバーレイ） | TC-031完了 | 1. モーダル外の背景をクリック | - モーダルが閉じる | 中 |
| TC-034 | モーダルを閉じる（ESCキー） | TC-031完了 | 1. ESCキーを押下 | - モーダルが閉じる | 低 |

---

### 2.5 タブ1: 基本情報

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-041 | 初期表示の確認 | TC-031完了 | 1. 基本情報タブを確認 | - 取引先名: 「ネクストビッツ」<br>- 表示名: 「株式会社ネクストビッツ 御中」<br>- 状態: 有効（スイッチON）<br>- 最終処理日が表示される | 高 |
| TC-042 | 取引先名を編集 | TC-041完了 | 1. 取引先名を「ネクストビッツ2」に変更<br>2. 「保存」をクリック | - Snackbar: 「取引先設定を保存しました」<br>- 一覧で取引先名が更新される | 高 |
| TC-043 | 表示名を編集 | TC-041完了 | 1. 表示名を変更<br>2. 「保存」をクリック | - Snackbar: 「取引先設定を保存しました」<br>- 一覧で表示名が更新される | 高 |
| TC-044 | 状態を変更（有効→無効） | TC-041完了 | 1. スイッチをOFFに変更<br>2. 「保存」をクリック | - Snackbar: 「取引先設定を保存しました」<br>- 一覧で状態が「無効」に変更される | 高 |
| TC-045 | 取引先名が空欄でエラー | TC-041完了 | 1. 取引先名を削除<br>2. 「保存」をクリック | - エラーメッセージ: 「取引先名を入力してください」<br>- 入力欄が赤枠で強調<br>- モーダルは閉じない | 高 |
| TC-046 | 表示名が空欄でエラー | TC-041完了 | 1. 表示名を削除<br>2. 「保存」をクリック | - エラーメッセージ: 「表示名を入力してください」<br>- 入力欄が赤枠で強調<br>- モーダルは閉じない | 高 |
| TC-047 | 両方空欄でエラー | TC-041完了 | 1. 取引先名と表示名を削除<br>2. 「保存」をクリック | - 両方にエラーメッセージ表示<br>- Snackbar: 「入力エラーがあります」 | 高 |

---

### 2.6 タブ2: テンプレート

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-051 | テンプレート情報表示 | TC-031完了 | 1. 「テンプレート」タブをクリック | - 現在のファイル: 「nextbits_template.xlsx」<br>- 更新日時が表示される<br>- 更新者: 「admin@example.com」<br>- ダウンロードボタンが表示される | 高 |
| TC-052 | テンプレートをダウンロード | TC-051完了 | 1. 「ダウンロード」ボタンをクリック | - ファイルがダウンロードされる<br>- またはダウンロードダイアログが表示される（モック: alert） | 高 |
| TC-053 | ファイルを選択 | TC-051完了 | 1. アップロードエリアをクリック<br>2. `.xlsx`ファイルを選択 | - ファイル名が表示される<br>- エリアが緑色に変わる<br>- ファイルアイコンが表示される | 高 |
| TC-054 | ファイルをアップロードして保存 | TC-053完了 | 1. 「保存」ボタンをクリック | - Snackbar: 「取引先設定を保存しました」<br>- 現在のファイルが更新される<br>- 更新日時が現在時刻になる | 高 |
| TC-055 | 不正なファイル形式でエラー | TC-051完了 | 1. アップロードエリアをクリック<br>2. `.pdf`ファイルを選択 | - ファイル選択ダイアログで `.xlsx` 以外が選択不可<br>- またはエラーメッセージ表示 | 中 |

---

### 2.7 タブ3: 処理ルール

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-061 | 処理ルール表示（ネクストビッツ） | TC-031完了 | 1. 「処理ルール」タブをクリック | - タイトル: 「処理ルール（読み取り専用）」<br>- ネクストビッツの処理ルールが表示される<br>- 注記: 「MVP版では読み取り専用。変更はコード修正が必要です。」 | 高 |
| TC-062 | 処理ルール表示（オフビートワークス） | TC-001完了 | 1. オフビートワークスの行をクリック<br>2. 「処理ルール」タブをクリック | - オフビートワークスの処理ルールが表示される<br>- ネクストビッツとは異なる内容 | 高 |
| TC-063 | 編集不可の確認 | TC-061完了 | 1. 処理ルールテキストをクリック | - 編集不可（テキスト選択のみ可能） | 中 |

---

### 2.8 タブ4: 処理履歴

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-071 | 処理履歴表示 | TC-031完了 | 1. 「処理履歴」タブをクリック | - タイトル: 「処理履歴（最新3件）」<br>- 注記: 「※ クリックするとP-003（処理履歴ページ）に遷移します」<br>- テーブルに最新3件が表示される | 高 |
| TC-072 | 履歴項目の確認 | TC-071完了 | 1. テーブルの内容を確認 | - 列: 処理日、処理者、状態<br>- 状態チップ: 「成功」（緑色） | 高 |
| TC-073 | 履歴行のホバー効果 | TC-071完了 | 1. 履歴行にマウスオーバー | - 背景色が変わる<br>- カーソルがポインターになる | 低 |
| TC-074 | 履歴行クリック（モック） | TC-071完了 | 1. 履歴行をクリック | - モック: 「P-003へ遷移」メッセージダイアログ<br>- 実装版（Phase 8）: P-003に遷移し、該当取引先でフィルタされる | 中 |

---

### 2.9 レスポンシブデザインテスト

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-081 | デスクトップ → モバイル切替 | TC-001完了 | 1. デスクトップサイズで表示<br>2. モバイルサイズ（375px）に変更 | - テーブル → カードレイアウトに変わる<br>- 全データが表示される | 高 |
| TC-082 | モバイル → デスクトップ切替 | TC-021完了 | 1. モバイルサイズで表示<br>2. デスクトップサイズに変更 | - カードレイアウト → テーブルに変わる<br>- 全データが表示される | 高 |
| TC-083 | モーダル：モバイル表示 | TC-031完了 | 1. モバイルサイズ（375px）でモーダルを開く | - モーダル幅: 95vw<br>- タブが均等に4分割（横スクロールなし）<br>- コンテンツエリアが固定高さ（350px）でスクロール可能<br>- ボタンが縦並び、全幅表示 | 高 |
| TC-084 | モーダル：タブレット表示 | TC-031完了 | 1. タブレットサイズ（768px）でモーダルを開く | - デスクトップと同じレイアウト | 中 |

---

### 2.10 複数タブ切替テスト

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-091 | 全タブ順次切替 | TC-031完了 | 1. 基本情報 → テンプレート → 処理ルール → 処理履歴 の順にタブをクリック | - 各タブのコンテンツが正しく表示される<br>- アクティブタブのスタイルが正しい | 高 |
| TC-092 | タブ切替時の高さ固定（デスクトップ） | TC-031完了 | 1. 複数タブを切り替える | - モーダルの高さが固定（600px）<br>- タブ切替時にモーダルサイズが変動しない | 高 |
| TC-093 | タブ切替時の高さ固定（モバイル） | TC-083完了 | 1. 複数タブを切り替える | - モーダルの高さが固定（500px）<br>- コンテンツエリアのみスクロール | 高 |
| TC-094 | フォーム入力後のタブ切替 | TC-041完了 | 1. 基本情報で取引先名を変更<br>2. テンプレートタブに切り替え<br>3. 基本情報タブに戻る | - 入力内容が保持されている | 中 |

---

### 2.11 エラーハンドリングテスト

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-101 | API通信エラーシミュレート | TC-001完了、APIをオフライン | 1. ページをリロード | - エラーSnackbar: 「取引先の読み込みに失敗しました」<br>- 空の一覧が表示される | 中 |
| TC-102 | 保存失敗シミュレート | TC-041完了、APIをオフライン | 1. 取引先名を変更<br>2. 「保存」をクリック | - エラーSnackbar: 「保存に失敗しました」<br>- モーダルは閉じない | 中 |
| TC-103 | ファイルアップロード失敗 | TC-053完了、APIをオフライン | 1. 「保存」をクリック | - エラーSnackbar: 「保存に失敗しました」 | 中 |

---

### 2.12 同時保存テスト

| TC# | テストケース | 前提条件 | 手順 | 期待結果 | 優先度 |
|-----|------------|---------|------|---------|--------|
| TC-111 | 基本情報とテンプレートを同時保存 | TC-031完了 | 1. 基本情報で取引先名を変更<br>2. テンプレートタブでファイルを選択<br>3. 「保存」をクリック | - 両方が保存される<br>- Snackbar: 「取引先設定を保存しました」<br>- 一覧で取引先名とテンプレート更新日時が更新される | 高 |
| TC-112 | 複数フィールド同時変更 | TC-031完了 | 1. 取引先名、表示名、状態を全て変更<br>2. 「保存」をクリック | - 全ての変更が保存される<br>- Snackbar: 「取引先設定を保存しました」 | 高 |

---

## 3. 実施優先度

### 高優先度（Phase 9で必須）

- ページアクセステスト（TC-001〜TC-003）
- 取引先一覧表示（TC-011〜TC-012、TC-021〜TC-023）
- モーダル基本操作（TC-031〜TC-032）
- 基本情報の編集と保存（TC-041〜TC-047）
- テンプレート操作（TC-051〜TC-054）
- 処理ルール表示（TC-061〜TC-062）
- 処理履歴表示（TC-071〜TC-072）
- レスポンシブデザイン（TC-081〜TC-083）
- タブ切替（TC-091〜TC-093）
- 同時保存（TC-111〜TC-112）

### 中優先度

- 状態表示（TC-013）
- モーダルクローズ（TC-033）
- ファイル形式エラー（TC-055）
- 処理ルール編集不可（TC-063）
- 履歴行クリック（TC-074）
- タブレット表示（TC-084）
- フォーム入力保持（TC-094）
- エラーハンドリング（TC-101〜TC-103）

### 低優先度

- ホバー効果（TC-014、TC-073）
- ESCキー（TC-034）

---

## 4. テスト環境セットアップ

### 前提条件

1. **Playwrightインストール**（Phase 9）
   ```bash
   npm install -D @playwright/test
   npx playwright install
   ```

2. **テストユーザー作成**
   - 管理者: `admin@example.com` / `password123`
   - 一般ユーザー: `user@example.com` / `password123`

3. **テストデータ**
   - ネクストビッツ（有効、テンプレート有り）
   - オフビートワークス（有効、テンプレート有り）

---

## 5. テスト実行コマンド（Phase 9）

```bash
# 全テスト実行
npx playwright test companies.spec.ts

# 特定のブラウザのみ
npx playwright test companies.spec.ts --project=chromium

# ヘッドフルモード（ブラウザ表示）
npx playwright test companies.spec.ts --headed

# デバッグモード
npx playwright test companies.spec.ts --debug

# レポート生成
npx playwright show-report
```

---

## 6. 成功基準

- 全高優先度テストが100%成功
- 中優先度テストが80%以上成功
- レスポンシブデザインが全デバイスで正常動作
- エラーハンドリングが適切に機能

---

**作成者**: Claude Code
**レビュー**: 未実施
**承認**: 未実施
